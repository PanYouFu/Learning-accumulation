> 钱包BFF研发记录

### 1223

#### 负载均衡策略

负载均衡策略有多种，例如轮询、随机、最少连接等。选择合适的负载均衡策略可以有效地分配请求，避免服务实例的负载不均衡。 

#### 缓存策略

#### 错误处理

### 1220

技术选型：express + ts

待解决问题：

1. 钱包前端需要哪些接口
   
   1. 登录鉴权类
   
   2. 业务接口
   
   3. 通用接口

2. bff需要哪些功能，且如何实现
   
   1. restAPI
   
   2. 并发处理
   
   3. 统一报错
   
   4. 单元测试
   
   5. 异步处理
   
   6. 部署相关
      
      1. 方式
      
      2. 域名
      
      3. 机器
- **中间件**：你可以根据需要为 Express 添加更多中间件，如 `body-parser`、`cors` 等。
- **路由管理**：如果项目需要多个路由，可以将路由逻辑拆分到不同文件中，使用 `express.Router` 进行模块化。
- **日志与错误处理**：可以使用 `morgan` 等中间件来进行请求日志记录，并在代码中加入统一的错误处理机制。
- **环境变量管理**：使用 `dotenv` 包来管理不同环境的配置。

---

#### 目录结构设计

- **src/**: 存放所有源代码。
  - **controllers/**: 控制器层，处理 HTTP 请求和响应。
  - **models/**: 定义数据模型，通常用于与数据库交互。
  - **services/**: 业务逻辑层，处理复杂的业务逻辑。
  - **middleware/**: 中间件层，用于处理身份验证、日志记录等通用任务。
  - **routes/**: 路由配置，定义 API 的 URL 和对应的控制器方法。
  - **app.ts**: 主应用程序入口文件。
  - **config/**: 配置文件，如数据库连接配置、环境变量配置等。
- **.env**: 存储环境变量，如数据库连接字符串、密钥等敏感信息。
- **tsconfig.json**: TypeScript 编译配置文件。
- **package.json**: 项目依赖和脚本配置文件。

#### 其他依赖

- **cors**: 用于处理跨域资源共享 (CORS)。
- **body-parser**: 解析请求体。
- **jsonwebtoken**: 生成和验证 JSON Web Tokens。
- **bcryptjs**: 密码哈希处理。
- **dotenv**: 加载 `.env` 文件中的环境变量。

#### 环境变量配置

将敏感信息保存在环境变量中（如数据库连接字符串、密钥等）存储在环境变量中

#### 使用 dotenv 加载环境变量

#### 配置tsconfig.ts

- **target**: 设置目标 JavaScript 版本。
- **module**: 设置模块系统。
- **outDir**: 指定编译后的文件输出目录。
- **strict**: 启用所有严格的类型检查选项。
- **esModuleInterop**: 允许从模块中默认导入非 ES 模块。
- **skipLibCheck**: 跳过类型声明文件的检查，以提高编译速度。
- **forceConsistentCasingInFileNames**: 强制文件名大小写一致，这对于 Windows 系统尤为重要。

#### BFF的设计原则

在给出改进方案之前，为了保证方向的正确性，我们先看下BFF的设计原则：

- BFF为前端而生，关注点在提升前端用户体验。
- BFF不承载业务能力，业务逻辑要下沉到合适的后端服务中。
- BFF不承载特定技术能力，必要时可以建立专门的服务承载，如文档打印、Excel生成、算法逻辑等。
- BFF不做后端服务的集成层，某个后端服务的数据变更需要同步到其他服务，不能通过BFF实现。
